---
// Librerías
import { getCollection, type CollectionEntry } from "astro:content";
import { Image } from "astro:assets";

// Types
import type { GetStaticPaths } from "astro";

// Layouts
import MainLayout from "../layouts/MainLayout.astro";

// Componentes
import Heading from "../components/elements/Heading.astro";
import TableOfContent from "../components/blog/TableOfContent.astro";
import Link from "../components/elements/Link.astro";
import Share from "../components/blog/Share.astro";

// Utilidades
import { slugify } from "../utils/utils";

// 1. Generate a new path for every collection entry
export const getStaticPaths = (async () => {
  const blogEntries = await getCollection("blog");
  return blogEntries.map((entry) => {
    const catSlug = slugify(entry.data.category);
    return {
      params: { slug: `${catSlug}/${entry.slug}` },
      props: { entry },
    };
  });
}) satisfies GetStaticPaths;

// 2. For your template, you can get the entry directly from the prop
interface Props {
  entry: CollectionEntry<"blog">;
}
const { entry } = Astro.props;
const { Content, headings } = await entry.render();
---

<MainLayout
  title={entry.data.title}
  description={entry.data.snippet.slice(3, 90)}
>
  <section class="container mx-auto max-w-5xl space-y-8 px-4 sm:px-6">
    <Heading tagType="h1" hClass="h1" classes="text-left">
      {entry.data.title}
    </Heading>
    <Image
      src={entry.data.image.src}
      alt={entry.data.image.alt}
      format="avif"
      quality={"low"}
      class="aspect-video w-full rounded-lg object-cover shadow-lg dark:shadow-slate-50/10"
    />
    <Share
      url={`${slugify(entry.data.category)}/${entry.slug}`}
      text={entry.data.title}
    />
  </section>
  <section
    class="container mx-auto space-y-12 px-4 sm:px-6 lg:flex lg:justify-center lg:gap-x-8 lg:space-y-0"
  >
    <aside>
      <div class="sticky top-4 max-w-xs space-y-4">
        <Heading tagType="h3" hClass="h3" classes="text-left">
          Contenido
        </Heading>
        <TableOfContent headings={headings} />
      </div>
    </aside>
    <div class="space-y-16">
      <article class="prose prose-lg prose-slate dark:prose-invert">
        <Content />
      </article>
      <div class="text-center">
        <Link href="/blog" style={"outline"} class="mx-auto">← Blog</Link>
      </div>
    </div>
  </section>
</MainLayout>
