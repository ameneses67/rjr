---
// Librerías
import { getCollection } from "astro:content";
import { Image } from "astro:assets";

// Layouts
import MainLayout from "../layouts/MainLayout.astro";

// Componentes
import Heading from "../components/elements/Heading.astro";
import Header from "../components/header/Header.astro";
import Main from "../components/elements/Main.astro";
import BlogCard from "../components/BlogCard.astro";

// Utilidades
import { getFormattedDate } from "../utils/utils";

// Filtrar posts draft=true y no futuros
const publishedBlogPosts = await getCollection(
  "blog",
  ({ data }) => !data.draft && data.publishDate < new Date(),
);

// Ordenar posts por fecha
publishedBlogPosts.sort(
  (a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf(),
);

const title = "Blog";
const description =
  "En nuestro blog encontrarás artículos básicos que te ayudarán a empezar a educarte en finanzas personales.";
---

<MainLayout {title} {description}>
  <Header />
  <Main>
    <Heading tagType="h1" hClass="h1">Nuestro blog</Heading>
    <div class="container mx-auto space-y-8 px-4 sm:px-6">
      {
        publishedBlogPosts.map((post) => (
          <article class="mx-auto max-w-3xl">
            <BlogCard
              blogTitle={post.data.title}
              updatedDate={post.data.publishDate}
              author={post.data.author}
              snippet={post.data.snippet}
              imgSrc={post.data.image.src}
              imgAlt={post.data.image.alt}
              slug={post.slug}
            />
          </article>
        ))
      }
    </div>
  </Main>
</MainLayout>
