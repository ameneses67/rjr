---
// Librerías
import { getCollection, type CollectionEntry } from "astro:content";

// Layouts
import MainLayout from "../layouts/MainLayout.astro";

// Componentes
import BlogHero from "../components/blog/BlogHero.astro";
import BlogList from "../components/blog/BlogList.astro";
import Pagination from "../components/blog/Pagination.astro";

// Definiendo páginas
const page = Number(Astro.url.searchParams.get("page")) || 1;
const postsPerPage = Number(import.meta.env.POSTS_PER_PAGE);
const start = postsPerPage * (page - 1);
const end = start + postsPerPage;

// Filtrar posts draft=true y no futuros
export const publishedBlogPosts: CollectionEntry<"blog">[] =
  await getCollection(
    "blog",
    ({ data }) => !data.draft && data.publishDate < new Date(),
  );

// Ordenar posts por fecha
publishedBlogPosts.sort(
  (a, b) => b.data.updateDate.valueOf() - a.data.updateDate.valueOf(),
);

const posts = publishedBlogPosts.slice(start, end);

const title = "Blog";
const description =
  "En nuestro blog encontrarás artículos básicos que te ayudarán a empezar a educarte en finanzas personales.";
---

<MainLayout {title} {description}>
  <BlogHero />
  <BlogList posts={posts} />
  <Pagination page={page} numberOfPosts={publishedBlogPosts.length} />
</MainLayout>
