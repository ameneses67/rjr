---
// Librerías
import type { GetStaticPaths } from "astro";
import { getCollection } from "astro:content";

// Layouts
import MainLayout from "../layouts/MainLayout.astro";

// Componentes
import Heading from "../components/elements/Heading.astro";

// Utilidades
import { slugify } from "../utils/utils";

export const getStaticPaths = (() => {
  return [
    {
      params: { categoria: slugify("Piensa como rico") },
      props: { name: "Piensa como rico" },
    },
    {
      params: { categoria: slugify("Educación financiera") },
      props: { name: "Educación financiera" },
    },
    {
      params: { categoria: slugify("Pon tu dinero a trabajar") },
      props: { name: "Pon tu dinero a trabajar" },
    },
  ];
}) satisfies GetStaticPaths;

const { categoria } = Astro.params;
const { name } = Astro.props;

// Filtrar posts draft=true, no futuros y posts correspondientes a cada categoría
const publishedBlogPosts = await getCollection(
  "blog",
  ({ data }) =>
    !data.draft &&
    data.publishDate < new Date() &&
    slugify(data.category) === categoria,
);

// Ordenar posts por fecha
publishedBlogPosts.sort(
  (a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf(),
);
---

<MainLayout title={name} description="Categorías de los artículos">
  <Heading tagType="h1" hClass="h1">
    {name}
  </Heading>
  <section class="container mx-auto px-4 sm:px-6">
    <div
      class="grid items-stretch gap-4 sm:grid-cols-2 sm:gap-6 md:grid-cols-3 lg:grid-cols-4"
    >
      {
        publishedBlogPosts.map((post) => (
          <div>
            <div class="space-y-4 bg-skin-fill-shade p-2 dark:bg-skin-fill-shade-dark sm:p-4 md:p-6 lg:p-8">
              <Heading tagType="h3" hClass="h3">
                {post.data.title}
              </Heading>
              <p set:html={post.data.snippet.slice(0, 100)} />
            </div>
          </div>
        ))
      }
    </div>
  </section>
</MainLayout>
